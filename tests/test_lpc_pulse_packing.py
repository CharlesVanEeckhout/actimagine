import sys
sys.path.append('..')

from package.aframe_data_handler import AFrameDataHandler


test_cases_mode0 = [
    {"values": "000000000000000000000000000000000000000000", "data": [0, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "700000000000000000000000000000000000000000", "data": [57344, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "070000000000000000000000000000000000000000", "data": [ 7168, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "007000000000000000000000000000000000000000", "data": [  896, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "000700000000000000000000000000000000000000", "data": [  112, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "000070000000000000000000000000000000000000", "data": [   14, 0, 0, 0, 0, 0, 0, 0]},
    {"values": "000007000000000000000000000000000000000000", "data": [0, 57344, 0, 0, 0, 0, 0, 0]},
    {"values": "000000700000000000000000000000000000000000", "data": [0,  7168, 0, 0, 0, 0, 0, 0]},
    {"values": "000000070000000000000000000000000000000000", "data": [0,   896, 0, 0, 0, 0, 0, 0]},
    {"values": "000000007000000000000000000000000000000000", "data": [0,   112, 0, 0, 0, 0, 0, 0]},
    {"values": "000000000700000000000000000000000000000000", "data": [0,    14, 0, 0, 0, 0, 0, 0]},
    {"values": "000000000070000000000000000000000000000000", "data": [0, 0, 57344, 0, 0, 0, 0, 0]},
    {"values": "000000000007000000000000000000000000000000", "data": [0, 0,  7168, 0, 0, 0, 0, 0]},
    {"values": "000000000000700000000000000000000000000000", "data": [0, 0,   896, 0, 0, 0, 0, 0]},
    {"values": "000000000000070000000000000000000000000000", "data": [0, 0,   112, 0, 0, 0, 0, 0]},
    {"values": "000000000000007000000000000000000000000000", "data": [0, 0,    14, 0, 0, 0, 0, 0]},
    {"values": "000000000000000700000000000000000000000000", "data": [0, 0, 0, 57344, 0, 0, 0, 0]},
    {"values": "000000000000000070000000000000000000000000", "data": [0, 0, 0,  7168, 0, 0, 0, 0]},
    {"values": "000000000000000007000000000000000000000000", "data": [0, 0, 0,   896, 0, 0, 0, 0]},
    {"values": "000000000000000000700000000000000000000000", "data": [0, 0, 0,   112, 0, 0, 0, 0]},
    {"values": "000000000000000000070000000000000000000000", "data": [0, 0, 0,    14, 0, 0, 0, 0]},
    {"values": "000000000000000000007000000000000000000000", "data": [0, 0, 0, 0, 57344, 0, 0, 0]},
    {"values": "000000000000000000000700000000000000000000", "data": [0, 0, 0, 0,  7168, 0, 0, 0]},
    {"values": "000000000000000000000070000000000000000000", "data": [0, 0, 0, 0,   896, 0, 0, 0]},
    {"values": "000000000000000000000007000000000000000000", "data": [0, 0, 0, 0,   112, 0, 0, 0]},
    {"values": "000000000000000000000000700000000000000000", "data": [0, 0, 0, 0,    14, 0, 0, 0]},
    {"values": "000000000000000000000000070000000000000000", "data": [0, 0, 0, 0, 0, 57344, 0, 0]},
    {"values": "000000000000000000000000007000000000000000", "data": [0, 0, 0, 0, 0,  7168, 0, 0]},
    {"values": "000000000000000000000000000700000000000000", "data": [0, 0, 0, 0, 0,   896, 0, 0]},
    {"values": "000000000000000000000000000070000000000000", "data": [0, 0, 0, 0, 0,   112, 0, 0]},
    {"values": "000000000000000000000000000007000000000000", "data": [0, 0, 0, 0, 0,    14, 0, 0]},
    {"values": "000000000000000000000000000000700000000000", "data": [0, 0, 0, 0, 0, 0, 57344, 0]},
    {"values": "000000000000000000000000000000070000000000", "data": [0, 0, 0, 0, 0, 0,  7168, 0]},
    {"values": "000000000000000000000000000000007000000000", "data": [0, 0, 0, 0, 0, 0,   896, 0]},
    {"values": "000000000000000000000000000000000700000000", "data": [0, 0, 0, 0, 0, 0,   112, 0]},
    {"values": "000000000000000000000000000000000070000000", "data": [0, 0, 0, 0, 0, 0,    14, 0]},
    {"values": "000000000000000000000000000000000007000000", "data": [0, 0, 0, 0, 0, 0, 0, 57344]},
    {"values": "000000000000000000000000000000000000700000", "data": [0, 0, 0, 0, 0, 0, 0,  7168]},
    {"values": "000000000000000000000000000000000000070000", "data": [0, 0, 0, 0, 0, 0, 0,   896]},
    {"values": "000000000000000000000000000000000000007000", "data": [0, 0, 0, 0, 0, 0, 0,   112]},
    {"values": "000000000000000000000000000000000000000700", "data": [0, 0, 0, 0, 0, 0, 0,    14]},
    {"values": "000000000000000000000000000000000000000070", "data": [1, 1, 1, 0, 0, 0, 0, 0]},
    {"values": "000000000000000000000000000000000000000007", "data": [0, 0, 0, 1, 1, 1, 0, 0]},
    {"values": "777777777777777777777777777777777777777777", "data": [65535, 65535, 65535, 65535, 65535, 65535, 65534, 65534]},
    {"values": "111111111111111111111111111111111111111111", "data": [9362, 9362, 9363, 9362, 9362, 9363, 9362, 9362]},
    {"values": "222222222222222222222222222222222222222222", "data": [18724, 18725, 18724, 18724, 18725, 18724, 18724, 18724]},
    {"values": "444444444444444444444444444444444444444444", "data": [37449, 37448, 37448, 37449, 37448, 37448, 37448, 37448]},
]

test_cases_mode1 = [
    {"values": "0000000000000000000000000000000000000000", "data": [0, 0, 0, 0, 0]},
    {"values": "3000000000000000000000000000000000000000", "data": [49152, 0, 0, 0, 0]},
    {"values": "0300000000000000000000000000000000000000", "data": [12288, 0, 0, 0, 0]},
    {"values": "0030000000000000000000000000000000000000", "data": [ 3072, 0, 0, 0, 0]},
    {"values": "0003000000000000000000000000000000000000", "data": [  768, 0, 0, 0, 0]},
    {"values": "0000300000000000000000000000000000000000", "data": [  192, 0, 0, 0, 0]},
    {"values": "0000030000000000000000000000000000000000", "data": [   48, 0, 0, 0, 0]},
    {"values": "0000003000000000000000000000000000000000", "data": [   12, 0, 0, 0, 0]},
    {"values": "0000000300000000000000000000000000000000", "data": [    3, 0, 0, 0, 0]},
    {"values": "0000000030000000000000000000000000000000", "data": [0, 49152, 0, 0, 0]},
    {"values": "0000000003000000000000000000000000000000", "data": [0, 12288, 0, 0, 0]},
    {"values": "0000000000300000000000000000000000000000", "data": [0,  3072, 0, 0, 0]},
    {"values": "0000000000030000000000000000000000000000", "data": [0,   768, 0, 0, 0]},
    {"values": "0000000000003000000000000000000000000000", "data": [0,   192, 0, 0, 0]},
    {"values": "0000000000000300000000000000000000000000", "data": [0,    48, 0, 0, 0]},
    {"values": "0000000000000030000000000000000000000000", "data": [0,    12, 0, 0, 0]},
    {"values": "0000000000000003000000000000000000000000", "data": [0,     3, 0, 0, 0]},
    {"values": "0000000000000000300000000000000000000000", "data": [0, 0, 49152, 0, 0]},
    {"values": "0000000000000000030000000000000000000000", "data": [0, 0, 12288, 0, 0]},
    {"values": "0000000000000000003000000000000000000000", "data": [0, 0,  3072, 0, 0]},
    {"values": "0000000000000000000300000000000000000000", "data": [0, 0,   768, 0, 0]},
    {"values": "0000000000000000000030000000000000000000", "data": [0, 0,   192, 0, 0]},
    {"values": "0000000000000000000003000000000000000000", "data": [0, 0,    48, 0, 0]},
    {"values": "0000000000000000000000300000000000000000", "data": [0, 0,    12, 0, 0]},
    {"values": "0000000000000000000000030000000000000000", "data": [0, 0,     3, 0, 0]},
    {"values": "0000000000000000000000003000000000000000", "data": [0, 0, 0, 49152, 0]},
    {"values": "0000000000000000000000000300000000000000", "data": [0, 0, 0, 12288, 0]},
    {"values": "0000000000000000000000000030000000000000", "data": [0, 0, 0,  3072, 0]},
    {"values": "0000000000000000000000000003000000000000", "data": [0, 0, 0,   768, 0]},
    {"values": "0000000000000000000000000000300000000000", "data": [0, 0, 0,   192, 0]},
    {"values": "0000000000000000000000000000030000000000", "data": [0, 0, 0,    48, 0]},
    {"values": "0000000000000000000000000000003000000000", "data": [0, 0, 0,    12, 0]},
    {"values": "0000000000000000000000000000000300000000", "data": [0, 0, 0,     3, 0]},
    {"values": "0000000000000000000000000000000030000000", "data": [0, 0, 0, 0, 49152]},
    {"values": "0000000000000000000000000000000003000000", "data": [0, 0, 0, 0, 12288]},
    {"values": "0000000000000000000000000000000000300000", "data": [0, 0, 0, 0,  3072]},
    {"values": "0000000000000000000000000000000000030000", "data": [0, 0, 0, 0,   768]},
    {"values": "0000000000000000000000000000000000003000", "data": [0, 0, 0, 0,   192]},
    {"values": "0000000000000000000000000000000000000300", "data": [0, 0, 0, 0,    48]},
    {"values": "0000000000000000000000000000000000000030", "data": [0, 0, 0, 0,    12]},
    {"values": "0000000000000000000000000000000000000003", "data": [0, 0, 0, 0,     3]},
    {"values": "3333333333333333333333333333333333333333", "data": [65535, 65535, 65535, 65535, 65535]},
    {"values": "1111111111111111111111111111111111111111", "data": [21845, 21845, 21845, 21845, 21845]},
    {"values": "2222222222222222222222222222222222222222", "data": [43690, 43690, 43690, 43690, 43690]},
]

test_cases_mode2 = [
    {"values": "00000000000000000000000000000000", "data": [0, 0, 0, 0]},
    {"values": "30000000000000000000000000000000", "data": [49152, 0, 0, 0]},
    {"values": "03000000000000000000000000000000", "data": [12288, 0, 0, 0]},
    {"values": "00300000000000000000000000000000", "data": [ 3072, 0, 0, 0]},
    {"values": "00030000000000000000000000000000", "data": [  768, 0, 0, 0]},
    {"values": "00003000000000000000000000000000", "data": [  192, 0, 0, 0]},
    {"values": "00000300000000000000000000000000", "data": [   48, 0, 0, 0]},
    {"values": "00000030000000000000000000000000", "data": [   12, 0, 0, 0]},
    {"values": "00000003000000000000000000000000", "data": [    3, 0, 0, 0]},
    {"values": "00000000300000000000000000000000", "data": [0, 49152, 0, 0]},
    {"values": "00000000030000000000000000000000", "data": [0, 12288, 0, 0]},
    {"values": "00000000003000000000000000000000", "data": [0,  3072, 0, 0]},
    {"values": "00000000000300000000000000000000", "data": [0,   768, 0, 0]},
    {"values": "00000000000030000000000000000000", "data": [0,   192, 0, 0]},
    {"values": "00000000000003000000000000000000", "data": [0,    48, 0, 0]},
    {"values": "00000000000000300000000000000000", "data": [0,    12, 0, 0]},
    {"values": "00000000000000030000000000000000", "data": [0,     3, 0, 0]},
    {"values": "00000000000000003000000000000000", "data": [0, 0, 49152, 0]},
    {"values": "00000000000000000300000000000000", "data": [0, 0, 12288, 0]},
    {"values": "00000000000000000030000000000000", "data": [0, 0,  3072, 0]},
    {"values": "00000000000000000003000000000000", "data": [0, 0,   768, 0]},
    {"values": "00000000000000000000300000000000", "data": [0, 0,   192, 0]},
    {"values": "00000000000000000000030000000000", "data": [0, 0,    48, 0]},
    {"values": "00000000000000000000003000000000", "data": [0, 0,    12, 0]},
    {"values": "00000000000000000000000300000000", "data": [0, 0,     3, 0]},
    {"values": "00000000000000000000000030000000", "data": [0, 0, 0, 49152]},
    {"values": "00000000000000000000000003000000", "data": [0, 0, 0, 12288]},
    {"values": "00000000000000000000000000300000", "data": [0, 0, 0,  3072]},
    {"values": "00000000000000000000000000030000", "data": [0, 0, 0,   768]},
    {"values": "00000000000000000000000000003000", "data": [0, 0, 0,   192]},
    {"values": "00000000000000000000000000000300", "data": [0, 0, 0,    48]},
    {"values": "00000000000000000000000000000030", "data": [0, 0, 0,    12]},
    {"values": "00000000000000000000000000000003", "data": [0, 0, 0,     3]},
    {"values": "33333333333333333333333333333333", "data": [65535, 65535, 65535, 65535]},
    {"values": "11111111111111111111111111111111", "data": [21845, 21845, 21845, 21845]},
    {"values": "22222222222222222222222222222222", "data": [43690, 43690, 43690, 43690]},
]

test_cases_mode3 = [
    {"values": "000000000000000000000000", "data": [0, 0, 0]},
    {"values": "300000000000000000000000", "data": [49152, 0, 0]},
    {"values": "030000000000000000000000", "data": [12288, 0, 0]},
    {"values": "003000000000000000000000", "data": [ 3072, 0, 0]},
    {"values": "000300000000000000000000", "data": [  768, 0, 0]},
    {"values": "000030000000000000000000", "data": [  192, 0, 0]},
    {"values": "000003000000000000000000", "data": [   48, 0, 0]},
    {"values": "000000300000000000000000", "data": [   12, 0, 0]},
    {"values": "000000030000000000000000", "data": [    3, 0, 0]},
    {"values": "000000003000000000000000", "data": [0, 49152, 0]},
    {"values": "000000000300000000000000", "data": [0, 12288, 0]},
    {"values": "000000000030000000000000", "data": [0,  3072, 0]},
    {"values": "000000000003000000000000", "data": [0,   768, 0]},
    {"values": "000000000000300000000000", "data": [0,   192, 0]},
    {"values": "000000000000030000000000", "data": [0,    48, 0]},
    {"values": "000000000000003000000000", "data": [0,    12, 0]},
    {"values": "000000000000000300000000", "data": [0,     3, 0]},
    {"values": "000000000000000030000000", "data": [0, 0, 49152]},
    {"values": "000000000000000003000000", "data": [0, 0, 12288]},
    {"values": "000000000000000000300000", "data": [0, 0,  3072]},
    {"values": "000000000000000000030000", "data": [0, 0,   768]},
    {"values": "000000000000000000003000", "data": [0, 0,   192]},
    {"values": "000000000000000000000300", "data": [0, 0,    48]},
    {"values": "000000000000000000000030", "data": [0, 0,    12]},
    {"values": "000000000000000000000003", "data": [0, 0,     3]},
    {"values": "333333333333333333333333", "data": [65535, 65535, 65535]},
    {"values": "111111111111111111111111", "data": [21845, 21845, 21845]},
    {"values": "222222222222222222222222", "data": [43690, 43690, 43690]},
]

def template_test_lpc_pulse_pack(test_cases_mode, pulse_packing_mode):
    aframe_data_handler = AFrameDataHandler()
    pulse_max = 7 if pulse_packing_mode == 0 else 3
    for test_case in test_cases_mode:
        aframe_data_handler.pulse_values = [int(val) * 2 - pulse_max for val in test_case["values"]]
        pulse_data = aframe_data_handler.pack_pulse_values(pulse_packing_mode)
        if pulse_data != test_case["data"]:
            raise Exception("data " + str(pulse_data) + " is different from expected data " + str(test_case["data"]))


def test_lpc_pulse_pack0():
    template_test_lpc_pulse_pack(test_cases_mode0, 0)


def test_lpc_pulse_pack1():
    template_test_lpc_pulse_pack(test_cases_mode1, 1)


def test_lpc_pulse_pack2():
    template_test_lpc_pulse_pack(test_cases_mode2, 2)


def test_lpc_pulse_pack3():
    template_test_lpc_pulse_pack(test_cases_mode3, 3)


def template_test_lpc_pulse_unpack(test_cases_mode, pulse_packing_mode):
    aframe_data_handler = AFrameDataHandler()
    pulse_max = 7 if pulse_packing_mode == 0 else 3
    for test_case in test_cases_mode:
        expected_pulse_values = [int(val) * 2 - pulse_max for val in test_case["values"]]
        aframe_data_handler.unpack_pulse_values(pulse_packing_mode, test_case["data"])
        pulse_values = aframe_data_handler.pulse_values
        if pulse_values != expected_pulse_values:
            raise Exception("values " + str(pulse_values) + " is different from expected values " + str(expected_pulse_values))


def test_lpc_pulse_unpack0():
    template_test_lpc_pulse_unpack(test_cases_mode0, 0)


def test_lpc_pulse_unpack1():
    template_test_lpc_pulse_unpack(test_cases_mode1, 1)


def test_lpc_pulse_unpack2():
    template_test_lpc_pulse_unpack(test_cases_mode2, 2)


def test_lpc_pulse_unpack3():
    template_test_lpc_pulse_unpack(test_cases_mode3, 3)

